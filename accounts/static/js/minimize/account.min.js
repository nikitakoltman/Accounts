$(function(){var t,a=null,n=!0,d=!1;function s(t){var n={},d={},s={},o={};$("#Accounts_table > tbody  > tr > td").length>0&&$("#Accounts_table > tbody  > tr > td").each(function(e,i){"td-site"==i.className?n[i.getAttribute("data-id")]=r(i.innerHTML,t):"td-description"==i.className?d[i.getAttribute("data-id")]=r(i.innerHTML,t):"td-login tdencrypt"==i.className?s[i.getAttribute("data-id")]=r(i.innerHTML,t):"td-password tdencrypt"==i.className&&(o[i.getAttribute("data-id")]=r(c(i.innerHTML,a),t))}),$.ajax({url:"change_or_create_master_password/",type:"POST",data:{sites:JSON.stringify(n),descriptions:JSON.stringify(d),logins:JSON.stringify(s),passwords:JSON.stringify(o),new_master_password:r(t,t)},success:function(t){"success"==t.status?location.href=location.href:swal("Ошибка!",t.result)}})}function o(){var t=$("#in-enterpassword").val();""===t?($("#in-enterpassword").focus(),$("#EnterKeyModal").modal("show")):""===(t=c(a,t))?($("#in-enterpassword").val(""),$("#in-enterpassword").focus(),$("#EnterKeyModal").modal("show")):(a=t,d=!0,$("#EnterKeyModal").modal("hide"))}function e(){$("#Accounts_table tr").length>1&&$("#Accounts_table").tablesorter({sortList:[[0,0]]})}function i(){var t=c($("#modal-password").val(),a);""!==t?n?l(t):(swal(t),n=!0):swal("Не правильный пароль")}function l(t){var a=$("<input>");$("#AccountModal").append(a),a.val(t).select(),document.execCommand("copy"),a.remove()}function r(t,a){return CryptoJS.AES.encrypt(t,a).toString()}function c(t,a){try{return CryptoJS.AES.decrypt(t,a).toString(CryptoJS.enc.Utf8)}catch(t){if("Malformed UTF-8 data"==t.message)return"";throw swal("Ошибка!","Error: function Decrypt()"),t}}a=$("body").attr("master_password"),$("body").attr("master_password",null),"DoesNotExist"!=a?$("#EnterKeyModal").modal("show"):($("#in-oldpassword").attr("disabled","disabled"),$("#MasterPasswordModal").modal("show")),$("#btnenterpassword").on("click",function(){o()}),$("#btnsendaccount").on("click",function(){var t,n,d,s;""!==$("#in-site").val()?""!==$("#in-description").val()?""!==$("#in-login").val()?""!==$("#in-password").val()?(t=$("#in-site").val(),n=$("#in-description").val(),d=$("#in-login").val(),s=r($("#in-password").val(),a),$.ajax({url:"create_account/",type:"POST",data:{site:r(t,a),description:r(n,a),login:r(d,a),password:s},success:function(a){if("success"==a.status){var o=a.accountid,i='<tr data-id="'+o+'"><td class="td-site" data-id="'+o+'">'+t+'</td><td class="td-description" data-id="'+o+'">'+n+'</td><td class="td-login tdencrypt" data-id="'+o+'">'+d+'</td><td class="td-password tdencrypt" data-id="'+o+'">'+s+'</td><td class="td-btn"><button class="btn btn-primary" data-toggle="modal" data-target="#AccountModal" data-id="'+o+'">Open</button></td></tr>';$("#Accounts_table").find("tbody").append(i),e(),e(),$("#CreateAccountModal").modal("hide"),$("#in-site").val(""),$("#in-description").val(""),$("#in-login").val(""),$("#in-password").val("")}else swal("Ошибка!",a.result)}})):swal('Заполните поле "Пароль"'):swal('Заполните поле "Логин"'):swal('Заполните поле "Описание"'):swal('Заполните поле "Сайт"')}),$("#btnsendmasterpassword").on("click",function(){""===$("#in-oldpassword").val()&&$("#in-oldpassword").attr("disabled")||""!==$("#in-oldpassword").val()&&!$("#in-oldpassword").attr("disabled")?""!==$("#in-newpassword").val()?""!==$("#in-renewpassword").val()?$("#in-newpassword").val()===$("#in-renewpassword").val()?$("#in-oldpassword").attr("disabled")?s($("#in-renewpassword").val()):a===$("#in-oldpassword").val()?s($("#in-renewpassword").val()):swal("Не правильный старый пароль"):swal("Пароли не совпадают"):swal('Заполните поле "Подтвердите новый пароль"'):swal('Заполните поле "Новый пароль"'):swal('Заполните поле "Старый пароль"')}),$("#modal-btn-delete").on("click",function(){swal({title:"Ты уверен?",text:"Эту запись потом не восстановить!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Да, удалить это!"},function(){var t;t=$("#modal-btn-delete").attr("data-diss-id"),$.ajax({url:"delete_account/",type:"POST",data:{account_id:t},success:function(a){"success"==a.status?($("#Accounts_table").find("tbody").find('tr[data-id="'+t+'"]').remove(),$("#AccountModal").modal("hide")):swal("Ошибка!",a.result)}})})}),$("#modal-btn-save").on("click",function(){var t,n,d,s,o;""!==c($("#modal-password").val(),a)?(t=$("#modal-site").val(),n=$("#modal-description").val(),d=$("#modal-login").val(),s=$("#modal-newpassword").val(),o=$("#AccountModal").find("#modal-btn-delete").attr("data-diss-id"),""!==s&&(s=r(s,a)),""!==$("#modal-site").val()?""!==$("#modal-description").val()?""!==$("#modal-login").val()?$.ajax({url:"change_info_account/",type:"POST",data:{site:r(t,a),description:r(n,a),login:r(d,a),new_password:s,account_id:o},success:function(a){if("success"==a.status){var e=$("#Accounts_table").find("tbody").find('tr[data-id="'+o+'"]');e.find(".td-site").text(t),e.find(".td-description").text(n),e.find(".td-login").text(d),""!==s&&(e.find(".td-password").text(s),$("#modal-newpassword").val("")),$("#AccountModal").modal("hide")}else swal("Ошибка!",a.result)}}):swal('Заполните поле "Логин"'):swal('Заполните поле "Описание"'):swal('Заполните поле "Сайт"')):swal("Не правильный пароль")}),$("#modal-btn-password").on("click",function(){i()}),$("#modal-btn-login").on("click",function(){l($("#Accounts_table").find('.td-login[data-id="'+$("#modal-btn-delete").attr("data-diss-id")+'"]').text())}),$("#AccountModal").on("show.bs.modal",function(t){var a=$(t.relatedTarget).attr("data-id"),n=$('.td-site[data-id="'+a+'"]').text(),d=$('.td-description[data-id="'+a+'"]').text(),s=$('.td-login[data-id="'+a+'"]').text(),o=$('.td-password[data-id="'+a+'"]').text();$(this).find("#modal-site").val(n),$(this).find("#modal-description").val(d),$(this).find("#modal-login").val(s),$(this).find("#modal-password").val(o),$(this).find("#modal-newpassword").val(""),$(this).find("#modal-btn-delete").attr("data-diss-id",a),$(this).find("#modal-btn-delete").attr("data-site",n)}),$("#EnterKeyModal").on("shown.bs.modal",function(){$("#in-enterpassword").focus()}),$("#EnterKeyModal").on("hidden.bs.modal",function(){d&&($("#Accounts_table > tbody  > tr > td").length>0&&($("#Accounts_table > tbody  > tr > td").each(function(t,n){"td-password tdencrypt"!==n.className&&"td-btn"!==n.className&&(n.innerHTML=c(n.innerHTML,a))}),e()),$(".account_container").css("display","block"))}),$("#in-search").on("keyup",function(){if(""===$(this).val())$("tbody tr").css("display","");else{var t=$("tbody tr .td-site:contains("+$(this).val().toLowerCase()+")");$("tbody tr").fadeOut(100),t.parent().fadeIn(100)}}),$("#in-enterpassword").on("keydown",function(t){13===t.keyCode&&o()}),$("#modal-btn-password").on("touchend mouseup",function(){clearTimeout(t)}).on("touchstart mousedown",function(){t=window.setTimeout(function(){n=!1,i()},500)})});